{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>Network Diagram</title>
</head>
<body>

	<script src="https://d3js.org/d3.v4.js"></script>
	<div id="data-vis"></div>
	<script type="text/javascript">
		function color(d){
			if(d.nodeType==0)
				return "#000000"
			if(d.nodeType==1)
				return "#ff0000"
			if(d.nodeType==2)
				return "#00ff00"
			if(d.nodeType==3)
				return "#0000ff"
						
			return "#69b3a2"
		}
		var data = {{dados|safe}};
		// set the dimensions and margins of the graph
		var margin = {top: 10, right: 10, bottom: 10, left: 10},
		  width = 1200 - margin.left - margin.right,
		  height = 600 - margin.top - margin.bottom;

		// append the svg object to the body of the page
		var svg = d3.select("#data-vis")
		.append("svg")
		  .attr("width", width + margin.left + margin.right)
		  .attr("height", height + margin.top + margin.bottom)
		  .call(d3.zoom().on("zoom", function () {
			svg.attr("transform", d3.event.transform)
			}))
		// .append("g")
		//   .attr("transform",
		//         "translate(" + margin.left + "," + margin.top + ")");
		var static_url = '{{st_url}}'
		//d3.json(static_url+'file/ch.json', function(data) {
			console.log(data)
			// Initialize the links
			var link = svg
				.selectAll("line")
				.data(data.links)
				.enter()
				.append("line")
				  .style("stroke", "#aaa")

			// Initialize the nodes
			var node = svg
				.selectAll("circle")
				.data(data.nodes)
				.enter()
				.append("circle")
				  .attr("r", 20)
				  .style("fill", function(d){return color(d)})

			// Let's list the force we wanna apply on the network
			var simulation = d3.forceSimulation(data.nodes)                 // Force algorithm is applied to data.nodes
			    .force("link", d3.forceLink()                               // This force provides links between nodes
			        .id(function(d) { return d.id; })                     // This provide  the id of a node
			        .links(data.links)                                    // and this the list of links
					)
					.force("charge", d3.forceManyBody().strength(-400))         // This adds repulsion between nodes. Play with the -400 for the repulsion strength
					.force("center", d3.forceCenter(width / 2, height / 2))     // This force attracts nodes to the center of the svg area
					.on("end", ticked);

			// This function is run at each iteration of the force algorithm, updating the nodes position.
			function ticked() {
				link
				    .attr("x1", function(d) { return d.source.x; })
				    .attr("y1", function(d) { return d.source.y; })
				    .attr("x2", function(d) { return d.target.x; })
				    .attr("y2", function(d) { return d.target.y; });

				node
				    .attr("cx", function (d) { return d.x+6; })
				    .attr("cy", function(d) { return d.y-6; });
			}
		//});


	</script>

</body>
</html>